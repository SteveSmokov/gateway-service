CREATE TABLE users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   created TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT now(),
   updated TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT now(),
   status VARCHAR(25) NOT NULL DEFAULT 'ACTIVE',
   username VARCHAR(100) NOT NULL,
   first_name VARCHAR(255),
   last_name VARCHAR(255),
   email VARCHAR(255),
   password VARCHAR(255) NOT NULL,
   CONSTRAINT pk_users PRIMARY KEY (id),
   UNIQUE (username), UNIQUE (email)
);

CREATE TABLE roles (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   created TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT now(),
   updated TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT now(),
   status VARCHAR(25) NOT NULL DEFAULT 'ACTIVE',
   name VARCHAR(100) NOT NULL,
   CONSTRAINT pk_roles PRIMARY KEY (id),
   UNIQUE (name)
);

CREATE TABLE user_roles (
  role_id BIGINT NOT NULL,
   user_id BIGINT NOT NULL
);

CREATE UNIQUE INDEX role_user_idx ON user_roles(role_id, user_id);

ALTER TABLE user_roles ADD CONSTRAINT fk_userol_on_role FOREIGN KEY (role_id) REFERENCES roles (id);
ALTER TABLE user_roles ADD CONSTRAINT fk_userol_on_user FOREIGN KEY (user_id) REFERENCES users (id);

INSERT INTO roles(name) VALUES ('ROLE_USER');
INSERT INTO roles(name) VALUES ('ROLE_ADMIN');